{"filter":false,"title":"crawler.js","tooltip":"/crawler.js","undoManager":{"mark":0,"position":0,"stack":[[{"group":"doc","deltas":[{"action":"insertText","range":{"start":{"row":0,"column":0},"end":{"row":0,"column":39}},"text":"var casper = require(\"casper\").create({"},{"action":"insertText","range":{"start":{"row":0,"column":39},"end":{"row":1,"column":0}},"text":"\n"},{"action":"insertLines","range":{"start":{"row":1,"column":0},"end":{"row":76,"column":0}},"lines":[" ","});"," ","var numberOfLinks = 0;","var currentLink = 0;","var links = [];","var buildPage, capture, selectLink, grabContent, writeContent;","var pageXML = '<channel>';","var fs = require('fs');","var filename = 'content.xml'"," ","casper.start(\"http://www.washingtonindependentreviewofbooks.com/archives/features/\", function() {","    numberOfLinks = this.evaluate(function() {","        return __utils__.findAll('.the_article a').length;","    });","    this.echo(numberOfLinks + \" items found\");","    ","    // cause jquery makes it easier","    casper.page.injectJs('/PATH/TO/jquery.js');","});"," ","// Capture links","capture = function() {","    links = this.evaluate(function() {","        var link = [];","        jQuery('.the_article a').each(function() {","            link.push($(this).attr('href'));","        });","        return link;","    });","    this.then(selectLink);","};"," ","selectLink = function() {","    if (currentLink < numberOfLinks) {","        this.then(grabContent);","    } else {","        pageXML += '</channel>'","    }","};"," ","grabContent = function() {","    var postTitle; ","    var postID;","    var postContent;"," ","    casper.open(links[currentLink]).then(function() {","        ","        // these will eventually be mapped into XML nodes","        postTitle   = this.fetchText('.post h2');","        postID      = this.getElementAttribute('.post', 'id');","        postContent = this.evaluate(function() {","            ","            // items on the scraped page that needed to be removed","            jQuery('.interactive_right').remove();","            jQuery('.shareinpost').remove();","            return jQuery('.entry').html();","        });"," ","        this.echo( 'processing item ' + currentLink + ' out of ' + numberOfLinks + ' | ' + postTitle + ' | entry #' + postID );","        pageXML += '<row><postposition><![CDATA[' + currentLink + ']]></postposition><title><![CDATA[' + postTitle + ']]></title><postContent><![CDATA[' + postContent + ']]></postContent><postId><![CDATA[' + postID + ']]></postId></row>';","    });"," ","    this.then(buildPage);","};"," ","buildPage = function() {","    this.echo('writing to ' + filename);","    fs.write(filename, pageXML, 'w');"," ","    currentLink++;","    this.then(selectLink);","};"," ","casper.then(capture);"]},{"action":"insertText","range":{"start":{"row":76,"column":0},"end":{"row":76,"column":13}},"text":"casper.run();"}]}]]},"ace":{"folds":[],"scrolltop":0,"scrollleft":0,"selection":{"start":{"row":15,"column":7},"end":{"row":15,"column":7},"isBackwards":false},"options":{"guessTabSize":true,"useWrapMode":false,"wrapToView":true},"firstLineState":0},"timestamp":1416564749128,"hash":"5b4ea3d400474ade23789379ab8894f775a44401"}